<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rail Flow Visual Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="orientation-notice">
        <span>Rotate your device for the full Rail Flow experience.</span>
    </div>
    <div class="app-viewport">
    <div class="app-shell">
        <header class="app-header">
            <div class="header-glow"></div>
            <div class="header-content">
                <div class="header-intro">
                    <span class="brand-badge">Rail Flow</span>
                    <h1>Visual Train Flow Orchestrator</h1>
                    <p>
                        Plan up to a thousand consists along complex SVG routes. Upload rail schematics, position consists
                        directly on the canvas, label electrified junctions, and monitor operational spacing in real time.
                    </p>
                </div>
                <ul class="header-pills">
                    <li>SVG-native mapping</li>
                    <li>1000 train timeline</li>
                    <li>Conflict intelligence</li>
                </ul>
            </div>
        </header>

        <main class="main-layout">
        <section class="controls-panel glass-panel">
            <div class="controls-grid">
                <div class="control-card">
                    <div class="control-title">
                        <span>①</span>
                        <h2>Train Matrix</h2>
                    </div>
                    <label>
                        Active Trains
                        <input id="train-count" type="range" min="1" max="1000" value="4">
                    </label>
                    <div class="control-meta">
                        <small>Drag to spawn up to 1000 consists</small>
                        <strong id="train-count-label">4 trains</strong>
                    </div>
                </div>

                <div class="control-card">
                    <div class="control-title">
                        <span>②</span>
                        <h2>Timeline & Track</h2>
                    </div>
                    <div class="slider-wrap">
                        <label>
                            Simulation Time
                            <input id="time-slider" type="range" min="0" max="180" value="0">
                        </label>
                        <div class="time-meta">
                            <strong id="time-label">08:00</strong>
                            <small id="time-offset-label">+0 min</small>
                        </div>
                    </div>
                    <div class="field-row">
                        <label>
                            Track Length (km)
                            <input id="track-length-input" type="number" min="10" max="5000" value="240" step="1">
                        </label>
                        <label>
                            Origin Station
                            <input id="station-start-input" type="text" maxlength="60" value="Origin Terminal">
                        </label>
                        <div class="multi-start-control">
                            <label>
                                Starting Nodes
                                <div class="multi-start-select">
                                    <select id="start-nodes-select" multiple></select>
                                    <div class="multi-start-actions">
                                        <button id="start-nodes-apply" class="secondary" type="button">Apply</button>
                                        <button id="start-nodes-clear" class="secondary" type="button">Clear</button>
                                    </div>
                                </div>
                            </label>
                            <small class="hint-text">
                                Choose one or more map nodes as origin points. Shift-click to multi-select trains for bulk assignment.
                            </small>
                        </div>
                        <label>
                            Destination Station
                            <input id="station-end-input" type="text" maxlength="60" value="Summit Station">
                        </label>
                    </div>
                    <div class="field-row">
                        <div id="station-list" class="station-list"></div>
                        <button id="add-station" class="secondary" type="button">Add Station</button>
                    </div>
                    <div class="field-row">
                        <label>
                            Playback Speed
                            <input id="playback-speed" type="range" min="0.25" max="4" step="0.25" value="1">
                        </label>
                        <div class="speed-meta">
                            <strong id="playback-speed-label">1.0×</strong>
                            <small class="hint-text">Adjust animation pace</small>
                        </div>
                    </div>
                    <div class="button-row">
                        <button id="play-toggle" type="button">Play</button>
                        <button id="reset-time" class="secondary" type="button">Reset Time</button>
                        <button id="scrub-back" class="secondary" type="button">« 1 min</button>
                        <button id="scrub-forward" class="secondary" type="button">+1 min »</button>
                    </div>
                </div>

                <div class="control-card">
                    <div class="control-title">
                        <span>③</span>
                        <h2>Map Overlay & Crossings</h2>
                    </div>
                    <label class="file-upload">
                        SVG Route Map
                        <input id="map-upload" type="file" accept=".svg,image/svg+xml">
                    </label>
                    <small id="map-status" class="hint-text">Upload a vector map. Red strokes/fills become crossings.</small>
                    <div class="button-row">
                        <button id="clear-map" class="secondary" type="button">Remove Map</button>
                        <button id="reset-crossings" class="secondary" type="button">Reset Crossings</button>
                    </div>
                    <div class="crossing-controls">
                        <h3>Crossing Labels</h3>
                        <div id="crossing-list" class="crossing-list"></div>
                    </div>
                </div>

                <div class="control-card">
                    <div class="control-title">
                        <span>④</span>
                        <h2>Scenario Management</h2>
                    </div>
                    <p class="hint-text">
                        Save the current setup or load a JSON preset. Metadata export keeps station and crossing names
                        aligned with your SVG map.
                    </p>
                    <div class="button-row">
                        <button id="scenario-save" type="button">Save Scenario</button>
                        <button id="scenario-load" class="secondary" type="button">Load Scenario</button>
                        <input id="scenario-load-input" type="file" accept="application/json" hidden>
                    </div>
                    <div class="button-row">
                        <button id="metadata-export" type="button">Export Map Metadata</button>
                        <button id="metadata-import" class="secondary" type="button">Import Map Metadata</button>
                        <input id="metadata-import-input" type="file" accept="application/json" hidden>
                    </div>
                    <small id="scenario-status" class="hint-text">No scenario actions performed yet.</small>
                </div>
            </div>

            <div class="train-controls" id="train-controls"></div>
        </section>

        <section class="visual-panel glass-panel">
            <div class="visual-header">
                <div>
                    <h2>Live Track View</h2>
                    <small id="track-length-summary">Origin Terminal → Summit Station (240 km)</small>
                </div>
                <div class="legend">
                    <span><span class="dot safe"></span>Safe Separation</span>
                    <span><span class="dot warning"></span>Unsafe Gap (&lt; 100 m)</span>
                </div>
                <div class="viewport-controls">
                    <button id="zoom-in" type="button" title="Zoom in">+</button>
                    <button id="zoom-out" type="button" title="Zoom out">-</button>
                    <button id="zoom-reset" class="secondary" type="button" title="Reset view">Reset View</button>
                </div>
            </div>

            <div class="svg-wrapper">
                <svg id="track-svg" viewBox="0 0 1200 280" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <linearGradient id="trainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#6df8ff"/>
                            <stop offset="100%" stop-color="#63f5b2"/>
                        </linearGradient>
                        <linearGradient id="warningGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#ff4f8b"/>
                            <stop offset="100%" stop-color="#ff926c"/>
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <g id="viewport-root">
                        <rect class="map-background" x="0" y="0" width="1200" height="280"></rect>
                        <g id="map-layer"></g>
                        <g id="track-base"></g>
                        <g id="train-layer"></g>
                    </g>
                </svg>
            </div>

            <div class="track-labels" id="track-labels"></div>
            <small class="hint-text">
                Click anywhere along the visible track or uploaded map to snap the active train to that kilometer mark.
            </small>

            <div class="warnings" id="warnings-panel">
                <div class="no-warnings">All clear — no spacing conflicts detected.</div>
            </div>

            <div class="conflict-console">
                <div class="conflict-controls">
                    <label>
                        Filter Conflicts
                        <select id="conflict-filter">
                            <option value="all">All trains</option>
                        </select>
                    </label>
                    <div class="conflict-control-buttons">
                        <button id="conflict-clear" class="secondary" type="button">Clear Log</button>
                        <button id="report-generate" type="button">Generate Report</button>
                    </div>
                </div>
                <div id="conflict-log-list" class="conflict-log-list">
                    <div class="conflict-empty">No conflicts recorded yet.</div>
                </div>
            </div>
        </section>
        </section>
        </main>
    </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

